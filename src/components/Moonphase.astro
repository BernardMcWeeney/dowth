---
// MoonPhase.astro
---

<div id="moon-phase" class="absolute top-5 right-5 w-[40px] h-[40px] rounded-full bg-white/20 shadow-[0_0_20px_rgba(255,255,255,0.5)] flex justify-center items-center text-xs md:w-[50px] md:h-[50px] md:top-5 md:right-5 cursor-help"></div>

<script>
  // Calculate current moon phase with more accurate algorithm
  function getMoonPhase() {
    const date = new Date();
    
    // Julian date calculation
    const year = date.getFullYear();
    const month = date.getMonth() + 1;
    const day = date.getDate();
    
    // Convert to Julian date
    let a = Math.floor((14 - month) / 12);
    let y = year + 4800 - a;
    let m = month + 12 * a - 3;
    let jd = day + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045;
    
    // Calculate days since new moon on Jan 6, 2000 (Julian date 2451550.1)
    const daysSinceNewMoon = jd - 2451550.1;
    const lunarCycle = 29.53058867; // More accurate lunar cycle in days
    
    // Calculate phase (0 to 1)
    const phase = (daysSinceNewMoon % lunarCycle) / lunarCycle;
    
    return phase;
  }
  
  // Update the moon display
  function updateMoonDisplay() {
    const phase = getMoonPhase();
    const moonEl = document.getElementById('moon-phase');
    
    // Visual representation (white circle with black shadow)
    if (!moonEl) return;
    
    // Create a more visually accurate moon representation
    moonEl.style.backgroundColor = "black";
    moonEl.style.boxShadow = "0 0 10px rgba(255, 255, 255, 0.3)";
    
    if (phase < 0.5) {
      // Waxing (right side visible)
      const percent = phase * 2;
      const gradient = `linear-gradient(90deg, black 0%, black ${50 - percent * 50}%, white ${50 - percent * 50}%, white 100%)`;
      moonEl.style.background = gradient;
    } else {
      // Waning (left side visible)
      const percent = (phase - 0.5) * 2;
      const gradient = `linear-gradient(90deg, white 0%, white ${percent * 50}%, black ${percent * 50}%, black 100%)`;
      moonEl.style.background = gradient;
    }
    
    // Add a tooltip with the current moon phase percentage
    const phaseNames = [
      "New Moon", "Waxing Crescent", "First Quarter",
      "Waxing Gibbous", "Full Moon", "Waning Gibbous",
      "Last Quarter", "Waning Crescent"
    ];
    
    const phaseIndex = Math.floor(phase * 8) % 8;
    moonEl.title = `${phaseNames[phaseIndex]} (${Math.round(phase * 100)}%)`;
  }
  
  // Call the function on page load
  document.addEventListener('DOMContentLoaded', updateMoonDisplay);
</script>